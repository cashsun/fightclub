<?php        class DBadapter{                private $con = null;                private $host = 'localhost';                private $user = 'kilima5';                private $pass = 'dss871220';                function connect(){            $this->con = mysql_connect($this->host,$this->user,$this->pass) or die(mysql_error());            mysql_set_charset('utf8', $this->con) or die('cannot set names to utf8');                        mysql_select_db("fightdb",$this->con) or die(mysql_error());        }                function disconnect(){                        mysql_close($this->con);                }                function last_insert_id(){            $result = mysql_query("SELECT LAST_INSERT_ID() AS id") or die(mysql_error());            $row = mysql_fetch_assoc($result);            $id = $row['id'];            return $id;        }                        function register($username, $passwd, $firstname, $lastname, $email, $avatar){            $this->connect();            $query = sprintf("CALL CreateUser('%s', '%s', '%s', '%s', '%s', %s)",                              mysql_real_escape_string($username),                              md5($passwd),                              mysql_real_escape_string($firstname),                              mysql_real_escape_string($lastname),                              mysql_real_escape_string($email),                              mysql_real_escape_string($avatar));            if($result = mysql_query($query) or die(mysql_error()))            {              /* if success */              $row = mysql_fetch_assoc($result);              return $row;            }            else              return array(uid=>-1);         }                function login($username, $passwd){            $this->connect();            $query = sprintf("CALL ValidateUser('%s', '%s')",                              mysql_real_escape_string($username),                              md5($passwd));            $result = mysql_query($query) or die(mysql_error());            if($row = mysql_fetch_assoc($result))              /* found entry */              return array('data'=>$row, 'valid' => true);            else              return array('valid' => false);        }                function getUser($uid){            $this->connect();            $query = sprintf("CALL GetUser('%s')",                              mysql_real_escape_string($uid));            $result = mysql_query($query) or die(mysql_error());            if($row = mysql_fetch_assoc($result))              /* found entry */              return array('data'=>$row, 'valid' => true);            else              return array('valid' => false);        }                function getTask($tid, $isOt){                        $this->connect();            if($isOt)            {              $dbtask = mysql_query("CALL GetTask($tid)") or die(mysql_error());              while ($dbtask_row = mysql_fetch_array($dbtask)){                  $result = $dbtask_row;                  $result['exp'] = $dbtask_row['expcount'];                  $result['date'] = $dbtask_row['ts'];                  $result['creatorname'] = $dbtask_row['firstname']." ".$dbtask_row['lastname'];                                }             }            else            {                          }                            return $result;                }        /*        function getAllOriByUid($uid){            $results = mysql_query("CALL GetAllMyOriTasks($uid)") or die(mysql_error());            return $results;        }                function getAllRepoByUid($uid){            $results = mysql_query("CALL GetAllMyRepoTasks($uid)") or die(mysql_error());            return $results;        }        */        function getAllByUid($uid){            $query = sprintf("CALL GetAllMyTasks(%s)", mysql_real_escape_string($uid));            $results = mysql_query($query) or die(mysql_error());            return $results;        }                function getAllByFuid($fuid,$uid){            $query = sprintf("CALL GetUserTasks(%s,%s)", mysql_real_escape_string($fuid),mysql_real_escape_string($uid));            $results = mysql_query($query) or die(mysql_error());            return $results;        }                function getMyFollows($uid){                        $this->connect();            $query = sprintf("CALL GetMyFollows(%s)", mysql_real_escape_string($uid));            $results = mysql_query($query) or die(mysql_error());            return $results;        }                function getMyFriends($uid){                        $this->connect();            $query = sprintf("CALL GetMyFriends(%s)", mysql_real_escape_string($uid));            $results = mysql_query($query) or die(mysql_error());            return $results;        }                function getMyFans($uid){                        $this->connect();            $query = sprintf("CALL GetMyFans(%s)", mysql_real_escape_string($uid));            $results = mysql_query($query) or die(mysql_error());            return $results;        }                function getUserFollows($fuid, $uid){                        $this->connect();            $query = sprintf("CALL GetUserFollows(%s, %s)",                               mysql_real_escape_string($fuid),                              mysql_real_escape_string($uid));            $results = mysql_query($query) or die(mysql_error());            return $results;        }                function searchUsers($uid,$key){            $this->connect();            $query = sprintf("CALL SearchUsers(%s,'%s')",mysql_real_escape_string($uid), mysql_real_escape_string($key));            $results = mysql_query($query) or die(mysql_error());            return $results;        }        function addFriend($uid,$fuid){            $this->connect();            $query = sprintf("CALL addFriend(%s,%s)",mysql_real_escape_string($uid), mysql_real_escape_string($fuid));            if( $result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['status'];            }            else              return -1;         }                function unfollowFriend($uid,$fuid){                        $this->connect();            $query = sprintf("CALL UnfollowFriend(%s,%s)",mysql_real_escape_string($uid) ,mysql_real_escape_string($fuid));               if($result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['rows_affected'];            }            else              return -1;               }                function createTaskGroup($uid, $title, $priority, $type){                        $this->connect();            $query = sprintf("CALL CreateTaskGroup(%s, '%s', %s, %s, '%s')",                                  mysql_real_escape_string($uid),                                  mysql_real_escape_string($title),                                  mysql_real_escape_string($priority),                                  mysql_real_escape_string($type),                                  "");            if(mysql_query($query) or die(mysql_error()))              return $this->last_insert_id();            else              return -1;          }                function updateTaskGroup($tgid, $title, $priority, $type){                        $this->connect();            $query = sprintf("CALL UpdateTaskGroup(%s,'%s',%s,%s,'%s')",                                mysql_real_escape_string($tgid),                                mysql_real_escape_string($title),                                mysql_real_escape_string($priority),                                mysql_real_escape_string($type),                                "");            if($result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['rows_affected'];            }            else              return -1;        }                function updateTaskGroupTaskOrder($tgid, $t_order){                        $this->connect();            $query = sprintf("CALL UpdateTaskGroupOrder(%s,'%s')",                                mysql_real_escape_string($tgid),                                mysql_real_escape_string($t_order));                if($result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['rows_affected'];            }            else              return -1;               }                 function deleteTaskGroup($tgid){                        $this->connect();            $query = sprintf("CALL DeleteTaskGroup(%s)", mysql_real_escape_string($tgid));            if($result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['rows_affected'];            }            else              return -1;               }                 function createOriTask($uid, $tgid, $content){                        $this->connect();            $query = sprintf("CALL CreateTask(%s, 0, %s, '%s')",                                  mysql_real_escape_string($uid),                                  mysql_real_escape_string($tgid),                                  mysql_real_escape_string($content));            if(mysql_query($query) or die(mysql_error()))              return $this->last_insert_id();            else              return -1;        }                function createRepoTask($uid, $otid, $tgid, $content){                        $this->connect();            $query = sprintf("CALL CreateTask(%s, %s, %s, '%s')",                                  mysql_real_escape_string($uid),                                  mysql_real_escape_string($otid),                                  mysql_real_escape_string($tgid),                                  mysql_real_escape_string($content));            if(mysql_query($query) or die(mysql_error()))              return $this->last_insert_id();            else              return -1;        }                function updateTask($tid, $content, $privacy, $time){                        $this->connect();            $query = sprintf("CALL UpdateTask(%s, '%s', %s, '%s')",                                mysql_real_escape_string($tid),                                mysql_real_escape_string($content),                                mysql_real_escape_string($privacy),                                date("Y-m-d H:i:s", strtotime(mysql_real_escape_string($time))));                 if($result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['rows_affected'];            }            else              return -1;               }                function updateAvatar($uid, $avatar){                        $this->connect();            $query = sprintf("CALL UpdateAvatar(%s,%s)",                                mysql_real_escape_string($uid),                                mysql_real_escape_string($avatar));                 if($result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['rows_affected'];            }            else              return -1;               }                function toggleTaskComplete($tid, $isdone){                        $this->connect();            $query = sprintf("CALL toogleTaskComplete(%s, %s)",                                mysql_real_escape_string($tid),                                mysql_real_escape_string($isdone));            if( $result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['status'];            }            else              return -1;                }                function deleteTask($tid){                        $this->connect();            $query = sprintf("CALL DeleteTask(%s)", mysql_real_escape_string($tid));               if($result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['rows_affected'];            }            else              return -1;               }                function fighto($uid, $tid){            $this->connect();            $query = sprintf("CALL Fighto(%s,%s)", mysql_real_escape_string($uid),mysql_real_escape_string($tid));               if($result=mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['status'];            }            else              return -1;        }                function createComment($uid, $tid, $content){            $this->connect();            $query = sprintf("CALL CreateComment(%s, %s, '%s')",                                  mysql_real_escape_string($uid),                                  mysql_real_escape_string($tid),                                  mysql_real_escape_string($content));            if(mysql_query($query) or die(mysql_error()))              return $this->last_insert_id();            else              return -1;        }                function deleteComment($commentid){            $this->connect();            $query = sprintf("CALL deleteComment(%s)",                                  mysql_real_escape_string($commentid));            if($result = mysql_query($query) or die(mysql_error()))            {              $row = mysql_fetch_assoc($result);              return $row['rows_affected'];            }            else              return -1;          }                function getComments($tid, $lastcid){            $this->connect();            $query = sprintf("CALL GetComments(%s,%s)",                           mysql_real_escape_string($tid),                          mysql_real_escape_string($lastcid));            $results = mysql_query($query) or die(mysql_error());            return $results;        }    }?>